(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7fc0ff2a"],{"3bab":function(t,e,n){"use strict";var a=n("4378"),s=n.n(a);s.a},4378:function(t,e,n){},"93dc":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",{staticClass:"settings"},[n("breadcrumb",{attrs:{data:["Message Center"]}}),n("div",{staticClass:"title flex flex-between flex-vcenter ptb-10 pull-left"},[n("span",{staticClass:"fs-20 font-bold"},[t._v(t._s(t.$t("task.Task List")))]),n("span",{staticClass:"ml-5 fc-green fs-14"},[t._v("( "+t._s(t.$t("task.Running Task Num"))+" "+t._s(t.runningTaskNum)+" )")])]),t.isLoaded?n("section",{staticClass:"mb-20"},[n("vxe-toolbar",{staticClass:"pull-right",attrs:{zoom:"",custom:""},scopedSlots:t._u([{key:"buttons",fn:function(){return[n("el-input",{staticClass:"width-250 mr-10",attrs:{size:"medium",placeholder:t.$t("common.keyword search"),"suffix-icon":"el-icon-search"},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}}),n("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-delete fs-14",circle:""},on:{click:t.deleteTaskBatch}})]},proxy:!0}],null,!1,1043174296)}),n("vxe-table",t._b({directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"xTable",staticStyle:{clear:"both"},attrs:{columns:t.columns,data:t.currentPageData},on:{"sort-change":t.sortChangeEvent}},"vxe-table",t.gridOptions,!1),[n("vxe-column",{attrs:{type:"checkbox",width:"60",align:"center"}}),t._l(t.columns,(function(e){var a=e.prop,s=e.label,i=e.minWidth,r=e.fixed,o=e.filters;return n("vxe-column",{key:a,attrs:{fixed:r,sortable:"",field:a,title:s,filters:o||null,"min-width":i||140},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,s=e.column;return["Option"===s.property?n("span",[t._v(t._s(a.Option[t.lang]))]):n("span",[t._v(t._s(a[s.property]))])]}}],null,!0)})})),n("vxe-column",{attrs:{fixed:"right",align:"center",title:t.$t("tables.Action"),width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(n){return t.viewDetail(e.row)}}},[t._v(t._s(t.$t("task.View")))]),n("el-button",{attrs:{type:"text",size:"small",disabled:!["Success","Failed","Stopped"].includes(e.row.Status)},on:{click:function(n){return t.deleteTask(e.row.TaskId)}}},[t._v(t._s(t.$t("common.Delete")))]),n("el-button",{attrs:{type:"text",size:"small",disabled:!["Running","Waiting"].includes(e.row.Status)},on:{click:function(n){return t.stopTask(e.row)}}},[t._v(t._s(t.$t("task.Stop")))])]}}],null,!1,3721541908)})],2),n("vxe-pager",{attrs:{"current-page":t.pagination.currentPage,"page-size":t.pagination.pageSize,"page-sizes":t.pagination.pageSizes,total:t.pagination.total,layouts:["PrevPage","JumpNumber","NextPage","FullJump","Sizes","Total"]},on:{"update:pageSize":function(e){return t.$set(t.pagination,"pageSize",e)},"update:page-size":function(e){return t.$set(t.pagination,"pageSize",e)},"page-change":t.handlePageChange}})],1):t._e()],1)},s=[],i=n("a34a"),r=n.n(i),o=n("c949"),c=n("08ba"),l=n("fe42");function u(t,e,n,a,s,i,r){try{var o=t[i](r),c=o.value}catch(l){return void n(l)}o.done?e(c):Promise.resolve(c).then(a,s)}function d(t){return function(){var e=this,n=arguments;return new Promise((function(a,s){var i=t.apply(e,n);function r(t){u(i,a,s,r,o,"next",t)}function o(t){u(i,a,s,r,o,"throw",t)}r(void 0)}))}}function p(t){return p="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}var f={data:function(){return{tableData:[],headerData:[],loading:!1,isLoaded:!1,searchKey:"",sort:{},pagination:{total:0,pageSize:10,pageSizes:[10,15,20,50,100,200,500,1e3],currentPage:1},gridOptions:{border:!0,resizable:!0,showHeaderOverflow:!0,showOverflow:!0,highlightHoverRow:!0,rowId:"TaskId",toolbarConfig:{zoom:!0,custom:!0},sortConfig:{trigger:"cell"},filterConfig:{}},clusters:[],runningTaskNum:null,timerId:null}},computed:{columns:function(){var t=this.clusters;return[{prop:"TaskId",label:this.$t("task.Task ID")},{prop:"ClusterName",label:this.$t("task.Cluster Name"),filters:t},{prop:"Type",label:this.$t("task.Task Type")},{prop:"Option",label:this.$t("task.Task Name")},{prop:"Status",label:this.$t("task.Task Status"),filters:[{label:"Waiting",value:"Waiting"},{label:"Running",value:"Running"},{label:"Failed",value:"Failed"},{label:"Success",value:"Success"},{label:"Stopped",value:"Stopped"}]},{prop:"Message",label:this.$t("task.Message")},{prop:"CreateTime",label:this.$t("task.Create Time")},{prop:"UpdateTime",label:this.$t("task.Update Time")},{prop:"Duration",label:this.$t("task.Duration")}]},lang:function(){return this.$i18n.locale.toUpperCase()},listData:function(){var t=this.searchKey,e=this.sort,n=e.property,a=e.order,s=this.lang,i=this.tableData.filter((function(e){var n,a,i,r,o,c=!0;return(null===(n=e.ClusterName)||void 0===n?void 0:n.includes(t))||(null===(a=e.Type)||void 0===a?void 0:a.includes(t))||(null===(i=e.Status)||void 0===i?void 0:i.includes(t))||(null===(r=e.Option[s])||void 0===r?void 0:r.includes(t))||(null===(o=e.TaskId)||void 0===o?void 0:o.includes(t))||(c=!1),c})).sort((function(t,e){var s=p(t[n]);if("number"===s){var i=t[n]-e[n];if("asc"===a)return i;if("desc"===a)return-i}else if("string"===s){var r;if(r=t[n].length===e[n].length?t[n].localeCompare(e[n]):t[n].length-e[n].length,"asc"===a)return r;if("desc"===a)return-r}}));return i},currentPageData:function(){var t,e=this.pagination,n=e.currentPage,a=e.pageSize;return null===(t=this.listData)||void 0===t?void 0:t.slice((n-1)*a,n*a)}},watch:{"listData.length":function(t){this.pagination.currentPage=1,this.pagination.total=t}},created:function(){var t=this;return d(r.a.mark((function e(){return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getClusterList();case 2:t.fetchData(),t.getRunningTasks(),t.timerId=setInterval(t.refresh,3e3);case 5:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){this.timerId&&clearInterval(this.timerId)},methods:{getClusterList:function(){var t=this;return d(r.a.mark((function e(){var n,a;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o["a"].getCluster();case 2:n=e.sent,a=n.data.entity,t.clusters=Object.keys(a).map((function(t){return{label:t,value:t}}));case 5:case"end":return e.stop()}}),e)})))()},sortChangeEvent:function(t){var e=t.property,n=t.order;this.sort={property:e,order:n}},handlePageChange:function(t){this.pagination.currentPage=t.currentPage},fetchData:function(){var t=this;return d(r.a.mark((function e(){var n,a;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o["h"].getLists()["finally"]((function(){t.isLoaded=!0}));case 2:n=e.sent,a=n.data.entity,t.tableData=a,0===a.filter((function(t){return!["Success","Failed","Stopped"].includes(t.Status)})).length&&t.timerId&&clearInterval(t.timerId);case 6:case"end":return e.stop()}}),e)})))()},deleteTask:function(t){var e=this;return d(r.a.mark((function n(){return r.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$confirm(e.$t("task.Delete Task"),e.$t("common.tips"),{confirmButtonText:e.$t("common.Confirm"),cancelButtonText:e.$t("common.Cancel")});case 2:return n.next=4,o["h"].deleteTask(t);case 4:c["c"].success(e.$t("common.Delete")+" "+e.$t("common.Success")),e.fetchData();case 6:case"end":return n.stop()}}),n)})))()},getRunningTasks:function(){var t=this;return d(r.a.mark((function e(){var n,a;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o["h"].getRunningLists();case 2:n=e.sent,a=n.data.entity,t.runningTaskNum=a;case 5:case"end":return e.stop()}}),e)})))()},viewDetail:function(t){Object(c["d"])({component:l["a"],props:{title:this.$t("task.View Task"),width:800,cancelText:this.$t("task.Close"),okText:null},data:{taskId:t.TaskId,refresh:["Waiting","Running"].includes(t.Status)}})},refresh:function(){this.fetchData(),this.getRunningTasks()},getSelectRecords:function(){var t=this.$refs.xTable,e=null===t||void 0===t?void 0:t.getCheckboxRecords();return e||[]},deleteTaskBatch:function(){var t=this;return d(r.a.mark((function e(){var n,a,s,i,l,u;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.getSelectRecords(),e.next=3,t.$confirm(t.$t("task.Delete Task"),t.$t("common.tips"),{confirmButtonText:t.$t("common.Confirm"),cancelButtonText:t.$t("common.Cancel")});case 3:return e.next=5,Promise.allSettled(i.map((function(t){return o["h"].deleteTask(t.TaskId)})));case 5:l=e.sent,1===l.length?"fulfilled"===l[0].status?c["c"].success(t.$t("common.Action Success")):c["c"].fuck(null===(s=null===(a=null===(n=l[0])||void 0===n?void 0:n.value)||void 0===a?void 0:a.data)||void 0===s?void 0:s.retMsg):(u=l.some((function(t){return"rejected"===t.status}))?c["c"].warning:c["c"].success,u("".concat(t.$t("common.Action Success"),", ").concat(t.$t("common.Success")).concat(l.filter((function(t){return"fulfilled"===t.status})).length,", ").concat(t.$t("common.Failed")).concat(l.filter((function(t){return"rejected"===t.status})).length))),c["c"].success(t.$t("common.Delete")+" "+t.$t("common.Success")),t.fetchData();case 9:case"end":return e.stop()}}),e)})))()},stopTask:function(t){var e=this;return d(r.a.mark((function n(){return r.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$confirm(e.$t("task.The current operation cannot be actually canceled, only the task status is changed to stopped"),e.$t("common.tips"),{confirmButtonText:e.$t("task.Stop"),cancelButtonText:e.$t("common.Cancel"),text:"warning"});case 2:return n.next=4,o["h"].stopTask(t.TaskId);case 4:e.$message.success(e.$t("common.Action Success"));case 5:case"end":return n.stop()}}),n)})))()}}},g=f,h=n("2877"),m=Object(h["a"])(g,a,s,!1,null,"408ec7cf",null);e["default"]=m.exports},fe42:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"task-detail"},[t.detail?n("div",{staticClass:"mb-20"},[n("label",[t._v(t._s(t.$t("task.Task ID"))+"：")]),n("span",{staticClass:"fc-black"},[t._v(t._s(t.detail.TaskId))]),n("label",{staticClass:"ml-20"},[t._v(t._s(t.$t("task.Cluster Name"))+"：")]),n("span",{staticClass:"fc-black"},[t._v(t._s(t.detail.ClusterName))]),n("label",{staticClass:"ml-20"},[t._v(t._s(t.$t("task.Current Action"))+"：")]),n("span",{staticClass:"fc-black"},[t._v(t._s(t.detail.Option[t.lang]))])]):t._e(),n("vxe-table",t._b({ref:"xTable",staticStyle:{clear:"both"},attrs:{size:"mini",columns:t.columns,data:t.currentPageData}},"vxe-table",t.gridOptions,!1),[n("vxe-column",{attrs:{fixed:"right",align:"center",title:t.$t("task.Node"),field:"Host"}}),n("vxe-column",{attrs:{fixed:"right",align:"center",title:t.$t("task.Status"),field:"Status"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("div",{staticClass:"flex flex-vcenter flex-center"},[t.loading?n("img",{staticClass:"mr-20",attrs:{src:"/images/5-130H2191322-50.gif"}}):t._e(),n("span",{staticClass:"status",class:e.row.Status.EN},[t._v(t._s(e.row.Status[t.lang]))])])]}}])})],1),n("vxe-pager",{attrs:{align:"center","current-page":t.pagination.currentPage,"page-size":t.pagination.pageSize,"page-sizes":t.pagination.pageSizes,total:t.pagination.total,layouts:["PrevPage","JumpNumber","NextPage","Total"]},on:{"update:pageSize":function(e){return t.$set(t.pagination,"pageSize",e)},"update:page-size":function(e){return t.$set(t.pagination,"pageSize",e)},"page-change":t.handlePageChange}})],1)},s=[],i=n("a34a"),r=n.n(i),o=n("c949");function c(t,e,n,a,s,i,r){try{var o=t[i](r),c=o.value}catch(l){return void n(l)}o.done?e(c):Promise.resolve(c).then(a,s)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(a,s){var i=t.apply(e,n);function r(t){c(i,a,s,r,o,"next",t)}function o(t){c(i,a,s,r,o,"throw",t)}r(void 0)}))}}var u={props:{taskId:String,refresh:Boolean},data:function(){return{timerId:null,detail:null,pagination:{total:0,pageSize:10,pageSizes:[10,15,20,50,100,200,500,1e3],currentPage:1},gridOptions:{border:!0,resizable:!0,showHeaderOverflow:!0,showOverflow:!0,highlightHoverRow:!0,rowId:"Host"},loading:!1,status:null}},computed:{columns:function(){return[{prop:"Host"},{prop:"Status"}]},lang:function(){return this.$i18n.locale.toUpperCase()},currentPageData:function(){var t,e,n=this.pagination,a=n.currentPage,s=n.pageSize;return null===(t=this.detail)||void 0===t||null===(e=t.NodeStatus)||void 0===e?void 0:e.slice((a-1)*s,a*s)}},created:function(){this.getTaskDetail(),this.refresh&&(this.loading=!0,this.timerId=setInterval(this.getTaskDetail,3e3))},beforeDestroy:function(){this.timerId&&clearInterval(this.timerId)},methods:{getTaskDetail:function(){var t=this;return l(r.a.mark((function e(){var n,a;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.status=null,e.next=3,o["h"].getTaskDetail(t.taskId);case 3:n=e.sent,a=n.data.entity,t.detail=a,t.pagination.currentPage=1,t.pagination.total=a.NodeStatus.length,0==a.NodeStatus.filter((function(t){return!["Done","Failed"].includes(t.Status.EN)})).length&&(clearInterval(t.timerId),t.loading=!1,a.NodeStatus.every((function(t){return"Done"===t.Status.EN}))?t.status="Done":t.status="Failed");case 9:case"end":return e.stop()}}),e)})))()},handlePageChange:function(t){this.pagination.currentPage=t.currentPage},onOk:function(){return this.status}}},d=u,p=(n("3bab"),n("2877")),f=Object(p["a"])(d,a,s,!1,null,"3f7c0af8",null);e["a"]=f.exports}}]);