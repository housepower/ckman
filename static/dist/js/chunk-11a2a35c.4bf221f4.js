(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11a2a35c"],{"3bab":function(e,t,a){"use strict";var n=a("4378"),s=a.n(n);s.a},4378:function(e,t,a){},"6ec5":function(e,t,a){},b27f:function(e,t,a){"use strict";var n=a("6ec5"),s=a.n(n);s.a},c308:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("main",{staticClass:"settings"},[a("breadcrumb",{attrs:{data:["Clusters",e.$route.params.id,"manage"]},scopedSlots:e._u([{key:"default",fn:function(){return e._l(e.clusterStatus,(function(t){return a("el-button",{key:t,staticClass:"fs-14",attrs:{type:"primary",size:"mini",disabled:e.isStatusDisable(t)},on:{click:function(a){return e.clusterOperation(t)}}},[e._v(e._s(e.$t("manage."+t+" Cluster")))])}))},proxy:!0}])}),a("section",{staticClass:"container"},[a("div",{staticClass:"uprade ptb-15"},[a("span",{staticClass:"fs-18 font-bold mb-15 inline-block"},[e._v(e._s(e.$t("manage.Upgrade Cluster")))]),a("div",{},[a("span",{staticClass:"fs-14 font-bold"},[e._v(e._s(e.$t("home.ClickHouse Version"))+": "+e._s(e.list.version))]),"deploy"===e.mode?[a("span",{staticClass:"fs-14 font-bold ml-30"},[e._v(e._s(e.$t("manage.Upgrade to"))+":")]),a("el-select",{staticClass:"ml-10 mr-10",attrs:{size:"small",clearable:"",filterable:""},model:{value:e.packageVersion,callback:function(t){e.packageVersion=t},expression:"packageVersion"}},e._l(e.versionOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),a("span",{staticClass:"fs-14 font-bold ml-0"},[e._v(e._s(e.$t("manage.Policy"))+":")]),a("el-select",{staticClass:"ml-10 mr-20",attrs:{size:"small",clearable:"",filterable:""},model:{value:e.policy,callback:function(t){e.policy=t},expression:"policy"}},[a("el-option",{attrs:{label:e.$t("manage.Full"),value:"Full"}}),a("el-option",{attrs:{label:e.$t("manage.Rolling"),value:"Rolling"}})],1),a("el-checkbox",{staticClass:"mr-50",model:{value:e.skip,callback:function(t){e.skip=t},expression:"skip"}},[e._v(e._s(e.$t("manage.skip same version")))]),a("el-button",{staticClass:"fs-16",attrs:{type:"primary",size:"mini",disabled:!e.packageVersion},on:{click:function(t){return e.clusterOperation("upgrade")}}},[e._v(e._s(e.$t("common.Upgrade")))])]:e._e()],2)]),a("div",{staticClass:"node-list"},[a("h3",{staticClass:"mt-15 mb-30"},[e._v(e._s(e.$t("home.ClickHouse Node List")))]),a("div",{staticClass:"search flex flex-between pull-left"},["deploy"===e.mode?a("el-button",{staticClass:"fs-16",attrs:{type:"primary",size:"medium"},on:{click:e.addNode}},[e._v(e._s(e.$t("manage.Add Node")))]):e._e()],1),a("vxe-toolbar",{staticClass:"pull-right",attrs:{zoom:"",custom:""},scopedSlots:e._u([{key:"buttons",fn:function(){return[a("el-input",{staticClass:"width-300",attrs:{placeholder:e.$t("common.keyword search"),autocomplete:"false",clearable:"",size:"medium","suffix-icon":"el-icon-search"},model:{value:e.input,callback:function(t){e.input=t},expression:"input"}})]},proxy:!0}])}),a("vxe-table",e._b({staticClass:"mt-10",staticStyle:{clear:"both"},attrs:{data:e.queryList,border:""}},"vxe-table",e.gridOptions,!1),[e._l(e.columns,(function(t,n){return a("vxe-column",{key:n,attrs:{field:t.prop,"show-overflow-tooltip":"",title:t.label,filters:t.filters||null,sortable:"",align:"center"},scopedSlots:e._u([{key:"default",fn:function(n){var s=n.row,r=n.column;return["status"===t.prop?a("div",[a("span",{staticClass:"dot mr-5",class:s.status}),e._v(e._s(s.status))]):a("span",[e._v(e._s(s[r.property]))])]}}],null,!0)})})),"deploy"===e.mode?a("vxe-column",{attrs:{title:e.$t("home.Actions"),align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;t.column;return[a("el-button",{attrs:{type:"text",disabled:"green"===n.status,loading:n.onlineLoading},on:{click:function(t){return e.onlineClusterNode(n)}}},[e._v(e._s(e.$t("manage.Online")))]),a("el-button",{attrs:{type:"text",disabled:"red"===n.status,loading:n.offlineLoading},on:{click:function(t){return e.offlineClusterNode(n)}}},[e._v(e._s(e.$t("manage.Offline")))]),a("i",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.$t("common.Delete"),expression:"$t('common.Delete')"}],staticClass:"fa fa-trash pointer fs-18 ml-10",on:{click:function(t){return e.remove(n)}}})]}}],null,!1,1376423824)},[void 0],2):e._e()],2)],1)])],1)},s=[],r=a("a34a"),o=a.n(r),i=a("d11e"),l=a("7b59"),c=a("2a23"),u=a("79f6");function d(e){return function(t){t=Object(u["a"])(t);var a=Object(l["a"])(t)?Object(c["a"])(t):void 0,n=a?a[0]:t.charAt(0),s=a?Object(i["a"])(a,1).join(""):t.slice(1);return n[e]()+s}}var p=d,f=p("toUpperCase"),m=f,h=p("toLowerCase"),v=h;function g(e){return e&&e.length?e[0]:void 0}var b=g;function w(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var k=w,x=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"add-node"},[a("el-form",{ref:"Form",attrs:{model:e.formModel,"label-width":"150px"}},[a("el-form-item",{attrs:{label:e.$t("manage.New Node IP")+":",prop:"ips"}},[a("el-input",{staticClass:"width-350",attrs:{type:"textarea",placeholder:e.$t("common.placeholderIp")},model:{value:e.formModel.ips,callback:function(t){e.$set(e.formModel,"ips",t)},expression:"formModel.ips"}})],1),a("el-form-item",{attrs:{label:e.$t("manage.Node Shard")+":",prop:"shard"}},[a("el-input-number",{attrs:{step:1,min:e.numberRange[0],max:e.numberRange[1]},model:{value:e.formModel.shard,callback:function(t){e.$set(e.formModel,"shard",t)},expression:"formModel.shard"}})],1)],1)],1)},$=[],C=a("c949"),y=a("c281");function _(e,t,a,n,s,r,o){try{var i=e[r](o),l=i.value}catch(c){return void a(c)}i.done?t(l):Promise.resolve(l).then(n,s)}function S(e){return function(){var t=this,a=arguments;return new Promise((function(n,s){var r=e.apply(t,a);function o(e){_(r,n,s,o,i,"next",e)}function i(e){_(r,n,s,o,i,"throw",e)}o(void 0)}))}}var N={props:["numberRange","password"],data:function(){return{formModel:{ips:"",shard:1}}},methods:{onOk:function(){var e=this;return S(o.a.mark((function t(){var a,n,s,r,i;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.formModel,n=a.ips,s=a.shard,t.next=3,C["a"].addClusterNode(e.$route.params.id,{ips:Object(y["c"])(Object(y["d"])(n)),shard:+s},e.password);case 3:return r=t.sent,i=r.data.entity,t.abrupt("return",i);case 6:case"end":return t.stop()}}),t)})))()}}},P=N,O=a("2877"),D=Object(O["a"])(P,x,$,!1,null,null,null),T=D.exports,z=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"add-node"},[a("el-form",{ref:"Form",attrs:{model:e.formModel}},[a("el-form-item",{attrs:{prop:"password",required:""}},[a("el-input",{attrs:{placeholder:e.$t("home.SSH Password"),"show-password":"",autocomplete:"new-password"},model:{value:e.formModel.password,callback:function(t){e.$set(e.formModel,"password",t)},expression:"formModel.password"}})],1)],1)],1)},I=[];function j(e,t,a,n,s,r,o){try{var i=e[r](o),l=i.value}catch(c){return void a(c)}i.done?t(l):Promise.resolve(l).then(n,s)}function M(e){return function(){var t=this,a=arguments;return new Promise((function(n,s){var r=e.apply(t,a);function o(e){j(r,n,s,o,i,"next",e)}function i(e){j(r,n,s,o,i,"throw",e)}o(void 0)}))}}var H={props:["password"],data:function(){return{formModel:{password:""}}},created:function(){this.formModel.password=this.password},methods:{onOk:function(){var e=this;return M(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.Form.validate();case 2:return t.abrupt("return",e.formModel.password);case 3:case"end":return t.stop()}}),t)})))()}}},V=H,L=Object(O["a"])(V,z,I,!1,null,null,null),R=L.exports,F=a("08ba"),E=a("8f12"),U=a("fe42");function W(e,t,a,n,s,r,o){try{var i=e[r](o),l=i.value}catch(c){return void a(c)}i.done?t(l):Promise.resolve(l).then(n,s)}function A(e){return function(){var t=this,a=arguments;return new Promise((function(n,s){var r=e.apply(t,a);function o(e){W(r,n,s,o,i,"next",e)}function i(e){W(r,n,s,o,i,"throw",e)}o(void 0)}))}}var B={data:function(){return{mode:"",versionOptions:[{value:"",label:""}],input:"",list:{status:"green",version:"",pkgType:"",nodes:[]},clusterStatus:[],packageVersion:"",skip:!0,policy:"Full",needPassword:!1,password:"",packageType:"",gridOptions:{border:!0,resizable:!0,showHeaderOverflow:!0,showOverflow:!0,highlightHoverRow:!0,rowId:"tableName",toolbarConfig:{zoom:!0,custom:!0},sortConfig:{trigger:"cell"},filterConfig:{}}}},computed:{queryList:function(){var e=this.list,t=this.input;return e.nodes.filter((function(e){return e.hostname.includes(t)||e.ip.includes(t)||e.status.includes(t)}))},columns:function(){return[{prop:"ip",label:this.$t("manage.Node IP"),minWidth:250,sortable:!0},{prop:"hostname",label:this.$t("manage.Node Name"),minWidth:250,sortable:!0},{prop:"shardNumber",label:this.$t("manage.shard number"),minWidth:250,sortable:!0},{prop:"replicaNumber",label:this.$t("manage.replica number"),minWidth:250,sortable:!0},{prop:"disk",label:this.$t("manage.Disk(Used/Total)"),minWidth:250,sortable:!0},{prop:"status",label:this.$t("manage.Node Status"),minWidth:250,sortable:!0,filters:[{label:"green",value:"green"},{label:"red",value:"red"}]}]}},mounted:function(){this.clusterStatus=Object.keys(E["a"]).filter((function(e){return"upgrade"!==e})).map((function(e){return m(e)})),this.fetchData()},methods:{fetchData:function(){var e=this;return A(o.a.mark((function t(){var a,n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,C["a"].getClusterInfo(e.$route.params.id);case 2:a=t.sent,n=a.data.entity,e.list=n,e.mode=n.mode,e.needPassword=n.needPassword,e.packageType=n.pkgType,e.fetchVersionData();case 9:case"end":return t.stop()}}),t)})))()},fetchVersionData:function(){var e=this;return A(o.a.mark((function t(){var a,n,s;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.packageType,t.next=3,C["d"].getList(a);case 3:n=t.sent,s=n.data.entity,e.versionOptions=s.map((function(t){return{value:t.version,label:t.version,disabled:t.version===e.list.version}}));case 6:case"end":return t.stop()}}),t)})))()},isStatusDisable:function(e){return"import"===this.mode||(!(!["start","destroy"].includes(v(e))||"red"===this.list.status)||"stop"===v(e)&&"red"===this.list.status)},numberRange:function(){var e=this.list.nodes;e=e.sort((function(e,t){return e.shardNumber-t.shardNumber}));var t=0===e.length?[1,1]:[b(e).shardNumber,k(e).shardNumber+1];return t},openPasswordDialog:function(){var e=this;return A(o.a.mark((function t(){var a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(F["d"])({component:R,props:{title:e.$t("home.SSH Password"),width:300,cancelText:e.$t("common.Cancel"),okText:e.$t("common.Confirm")},data:{password:e.password}}).then((function(e){return e}));case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))()},addNode:function(){var e=this;return A(o.a.mark((function t(){var a;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a="",!e.needPassword){t.next=5;break}return t.next=4,e.openPasswordDialog();case 4:a=t.sent;case 5:return t.next=7,Object(F["d"])({component:T,props:{title:e.$t("manage.Add Node"),width:600,cancelText:e.$t("common.Cancel"),okText:e.$t("common.Save")},data:{numberRange:e.numberRange(),password:a}}).then((function(t){t&&Object(F["d"])({component:U["a"],props:{title:e.$t("task.View Task"),width:800,cancelText:e.$t("task.Close"),okText:null},data:{taskId:t,refresh:!0}})["finally"]((function(){return e.fetchData()}))}));case 7:case"end":return t.stop()}}),t)})))()},remove:function(e){var t=this;return A(o.a.mark((function a(){var n,s,r;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n="",!t.needPassword){a.next=5;break}return a.next=4,t.openPasswordDialog();case 4:n=a.sent;case 5:return a.next=7,t.$confirm(t.$t("common.Confirm Delete"),t.$t("common.tips"),{confirmButtonText:t.$t("common.Delete"),cancelButtonText:t.$t("common.Cancel"),text:"warning"});case 7:return a.next=9,C["a"].deleteClusterNode(t.$route.params.id,{ip:e.ip},n);case 9:s=a.sent,r=s.data.entity,r&&Object(F["d"])({component:U["a"],props:{title:t.$t("task.View Task"),width:800,cancelText:t.$t("task.Close"),okText:null},data:{taskId:r,refresh:!0}})["finally"]((function(){return t.fetchData()}));case 12:case"end":return a.stop()}}),a)})))()},clusterOperation:function(e){var t=this;return A(o.a.mark((function a(){var n,s,r,i,l,c,u;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n="",!t.needPassword){a.next=5;break}return a.next=4,t.openPasswordDialog();case 4:n=a.sent;case 5:return e=v(e),a.next=8,t.$confirm(t.$t("common."+E["a"][e]),t.$t("common.tips"),{confirmButtonText:t.$t("common.Confirm"),cancelButtonText:t.$t("common.Cancel")});case 8:return F["b"].increase(),s={clusterName:t.$route.params.id},"upgrade"===e&&(r=t.packageVersion,i=t.policy,l=t.skip,s=Object.assign(s,{packageVersion:r,policy:i,skip:l})),a.next=13,C["a"].manageCluster(e,s,n)["finally"]((function(){return F["b"].decrease()}));case 13:if(c=a.sent,u=c.data.entity,"upgrade"!==e&&"destroy"!==e||!u){a.next=20;break}return a.next=18,Object(F["d"])({component:U["a"],props:{title:t.$t("task.View Task"),width:800,cancelText:t.$t("task.Close"),okText:null},data:{taskId:u,refresh:!0}})["finally"]((function(){"destroy"!==e?t.fetchData():t.$router.push("/home")}));case 18:a.next=22;break;case 20:t.$message.success("".concat(t.$t("manage."+m(e)+" Cluster"))+" ".concat(t.$t("common.Success"))),t.fetchData();case 22:case"end":return a.stop()}}),a)})))()},onlineClusterNode:function(e){var t=this;return A(o.a.mark((function a(){var n,s;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n="",!t.needPassword){a.next=5;break}return a.next=4,t.openPasswordDialog();case 4:n=a.sent;case 5:return t.$set(e,"onlineLoading",!0),s=t.$route.params.id,a.next=9,C["a"].onlineClusterNode(s,e.ip,n);case 9:t.$message.success("".concat(t.$t("manage.Online"))+" ".concat(t.$t("common.Success"))),t.fetchData(),t.$set(e,"onlineLoading",!1);case 12:case"end":return a.stop()}}),a)})))()},offlineClusterNode:function(e){var t=this;return A(o.a.mark((function a(){var n,s;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n="",!t.needPassword){a.next=5;break}return a.next=4,t.openPasswordDialog();case 4:n=a.sent;case 5:return t.$set(e,"offlineLoading",!0),s=t.$route.params.id,a.next=9,C["a"].offlineClusterNode(s,e.ip,n);case 9:t.$message.success("".concat(t.$t("manage.Offline"))+" ".concat(t.$t("common.Success"))),t.fetchData(),t.$set(e,"offlineLoading",!1);case 12:case"end":return a.stop()}}),a)})))()},filterHandler:function(e,t,a){var n=a["property"];return t[n]===e}}},q=B,J=(a("b27f"),Object(O["a"])(q,n,s,!1,null,"9934909e",null));t["default"]=J.exports},fe42:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"task-detail"},[e.detail?a("div",{staticClass:"mb-20"},[a("label",[e._v(e._s(e.$t("task.Task ID"))+"：")]),a("span",{staticClass:"fc-black"},[e._v(e._s(e.detail.TaskId))]),a("label",{staticClass:"ml-20"},[e._v(e._s(e.$t("task.Cluster Name"))+"：")]),a("span",{staticClass:"fc-black"},[e._v(e._s(e.detail.ClusterName))]),a("label",{staticClass:"ml-20"},[e._v(e._s(e.$t("task.Current Action"))+"：")]),a("span",{staticClass:"fc-black"},[e._v(e._s(e.detail.Option[e.lang]))])]):e._e(),a("vxe-table",e._b({ref:"xTable",staticStyle:{clear:"both"},attrs:{size:"mini",columns:e.columns,data:e.currentPageData}},"vxe-table",e.gridOptions,!1),[a("vxe-column",{attrs:{fixed:"right",align:"center",title:e.$t("task.Node"),field:"Host"}}),a("vxe-column",{attrs:{fixed:"right",align:"center",title:e.$t("task.Status"),field:"Status"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"flex flex-vcenter flex-center"},[e.loading?a("img",{staticClass:"mr-20",attrs:{src:"/images/5-130H2191322-50.gif"}}):e._e(),a("span",{staticClass:"status",class:t.row.Status.EN},[e._v(e._s(t.row.Status[e.lang]))])])]}}])})],1),a("vxe-pager",{attrs:{align:"center","current-page":e.pagination.currentPage,"page-size":e.pagination.pageSize,"page-sizes":e.pagination.pageSizes,total:e.pagination.total,layouts:["PrevPage","JumpNumber","NextPage","Total"]},on:{"update:pageSize":function(t){return e.$set(e.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.pagination,"pageSize",t)},"page-change":e.handlePageChange}})],1)},s=[],r=a("a34a"),o=a.n(r),i=a("c949");function l(e,t,a,n,s,r,o){try{var i=e[r](o),l=i.value}catch(c){return void a(c)}i.done?t(l):Promise.resolve(l).then(n,s)}function c(e){return function(){var t=this,a=arguments;return new Promise((function(n,s){var r=e.apply(t,a);function o(e){l(r,n,s,o,i,"next",e)}function i(e){l(r,n,s,o,i,"throw",e)}o(void 0)}))}}var u={props:{taskId:String,refresh:Boolean},data:function(){return{timerId:null,detail:null,pagination:{total:0,pageSize:10,pageSizes:[10,15,20,50,100,200,500,1e3],currentPage:1},gridOptions:{border:!0,resizable:!0,showHeaderOverflow:!0,showOverflow:!0,highlightHoverRow:!0,rowId:"Host"},loading:!1,status:null}},computed:{columns:function(){return[{prop:"Host"},{prop:"Status"}]},lang:function(){return this.$i18n.locale.toUpperCase()},currentPageData:function(){var e,t,a=this.pagination,n=a.currentPage,s=a.pageSize;return null===(e=this.detail)||void 0===e||null===(t=e.NodeStatus)||void 0===t?void 0:t.slice((n-1)*s,n*s)}},created:function(){this.getTaskDetail(),this.refresh&&(this.loading=!0,this.timerId=setInterval(this.getTaskDetail,3e3))},beforeDestroy:function(){this.timerId&&clearInterval(this.timerId)},methods:{getTaskDetail:function(){var e=this;return c(o.a.mark((function t(){var a,n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.status=null,t.next=3,i["h"].getTaskDetail(e.taskId);case 3:a=t.sent,n=a.data.entity,e.detail=n,e.pagination.currentPage=1,e.pagination.total=n.NodeStatus.length,0==n.NodeStatus.filter((function(e){return!["Done","Failed"].includes(e.Status.EN)})).length&&(clearInterval(e.timerId),e.loading=!1,n.NodeStatus.every((function(e){return"Done"===e.Status.EN}))?e.status="Done":e.status="Failed");case 9:case"end":return t.stop()}}),t)})))()},handlePageChange:function(e){this.pagination.currentPage=e.currentPage},onOk:function(){return this.status}}},d=u,p=(a("3bab"),a("2877")),f=Object(p["a"])(d,n,s,!1,null,"3f7c0af8",null);t["a"]=f.exports}}]);