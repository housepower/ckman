(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1a2330f4"],{"0148":function(t,e,n){"use strict";function a(t,e,n,a){var s=t.length,i=n+(a?1:-1);while(a?i--:++i<s)if(e(t[i],i,t))return i;return-1}var s=a;function i(t){return t!==t}var l=i;function r(t,e,n){var a=n-1,s=t.length;while(++a<s)if(t[a]===e)return a;return-1}var c=r;function u(t,e,n){return e===e?c(t,e,n):s(t,l,n)}e["a"]=u},3355:function(t,e,n){"use strict";function a(t){return null===t}e["a"]=a},"4b96":function(t,e,n){},"6e7d":function(t,e,n){"use strict";var a=n("814e"),s=n.n(a);s.a},"814e":function(t,e,n){},"8c16":function(t,e,n){"use strict";var a=n("d077"),s=n.n(a);s.a},"8cbb":function(t,e,n){"use strict";var a=n("9ac7"),s=n("0148");function i(t,e){var n=null==t?0:t.length;return!!n&&Object(s["a"])(t,e,0)>-1}var l=i;function r(t,e,n){var a=-1,s=null==t?0:t.length;while(++a<s)if(n(e,t[a]))return!0;return!1}var c=r,u=n("6568"),o=n("a55c");function f(){}var h=f,p=n("1989"),d=1/0,v=o["a"]&&1/Object(p["a"])(new o["a"]([,-0]))[1]==d?function(t){return new o["a"](t)}:h,g=v,b=200;function m(t,e,n){var s=-1,i=l,r=t.length,o=!0,f=[],h=f;if(n)o=!1,i=c;else if(r>=b){var d=e?null:g(t);if(d)return Object(p["a"])(d);o=!1,i=u["a"],h=new a["a"]}else h=e?[]:f;t:while(++s<r){var v=t[s],m=e?e(v):v;if(v=n||0!==v?v:0,o&&m===m){var x=h.length;while(x--)if(h[x]===m)continue t;e&&h.push(m),f.push(v)}else i(h,m,n)||(h!==f&&h.push(m),f.push(v))}return f}e["a"]=m},ba39:function(t,e,n){"use strict";var a=n("4b96"),s=n.n(a);s.a},d077:function(t,e,n){},f204:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",{staticClass:"query"},[n("breadcrumb",{attrs:{data:["Clusters",t.$route.params.id,"query-execution"]}}),n("left-aside",{attrs:{list:t.list},on:{selectSql:t.selectSql}}),n("section",{staticClass:"container custom-scrollbar"},[n("tags",{attrs:{list:t.list,selectSql:t.selectedSql},on:{updateData:t.updateData}})],1)],1)},s=[],i=n("3355"),l=n("7f2c"),r=n("8cbb");function c(t,e){return t&&t.length?Object(r["a"])(t,Object(l["a"])(e,2)):[]}var u=c,o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",{staticClass:"left-aside-warp custom-scrollbar"},[n("div",{staticClass:"left-aside-content"},[n("ul",{staticClass:"custom-scrollbar"},[n("li",{staticClass:"flex flex-column ptb-15 plr-10 flex-center"},[n("span",{staticClass:"fs-18 font-bold mb-10"},[t._v(t._s(t.$t("queryExecution.Query History")))]),n("el-input",{staticClass:"width-200",attrs:{placeholder:"search",autocomplete:"false",clearable:""},on:{input:t.filterData},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}})],1),t._l(t.searchList,(function(e,a){return n("li",{key:a,class:["flex","flex-column","ptb-15","plr-10","flex-center","pointer",{active:t.activeIndex===a}],on:{click:function(n){return t.selectSql(e,a)}}},[n("span",{staticClass:"text-line-clamp"},[t._v(" "+t._s(e.value))])])}))],2)])])},f=[],h={props:{list:{type:Array,default:[]}},data:function(){return{input:"",searchList:this.list,activeIndex:-1}},mounted:function(){},methods:{filterData:function(){var t=this;""===this.input&&(this.searchList=this.list),this.searchList=this.searchList.filter((function(e){return e.value.includes(t.input)}))},selectSql:function(t,e){this.activeIndex=e,this.$emit("selectSql",t)}},watch:{list:function(t){this.searchList=t}}},p=h,d=(n("6e7d"),n("2877")),v=Object(d["a"])(p,o,f,!1,null,"218ce74b",null),g=v.exports,b=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main",{staticClass:"manageContent"},[n("section",{staticClass:"rightSql custom-scrollbar"},[n("div",{staticClass:"tags flex-vcenter"},[t._l(t.tagsList,(function(e,a){return n("el-tag",{key:a,class:["fs-14","mr-10","pointer","tag","flex","flex-vcenter",{active:t.activeIndex===a}],attrs:{type:"info",closable:"","disable-transitions":!1},on:{close:function(n){return t.handleClose(e,a)},click:function(n){return t.clickTag(e,a)}}},[t._v(" "+t._s(e.value.length<10?""+e.value.substr(0,10):e.value.substr(0,10)+"...")+" ")])})),n("i",{staticClass:"fa fa-plus-square-o fs-28 pointer mr-10",on:{click:t.addTag}})],2)]),n("el-input",{ref:"elInput",staticClass:"width-full",attrs:{type:"textarea",autosize:{minRows:8},disabled:!this.tagsList.length},model:{value:t.sqlInput,callback:function(e){t.sqlInput=e},expression:"sqlInput"}}),n("el-button",{staticClass:"fs-18 width-full mt-15",attrs:{type:"primary",size:"large",disabled:""===t.sqlInput},on:{click:t.query}},[t._v(t._s(t.$t("queryExecution.Execute Query")))]),n("section",{staticClass:"list"},[n("el-table",{staticClass:"mt-15",attrs:{data:t.tableData.slice((t.currentPage-1)*t.pageSize,t.currentPage*t.pageSize),border:""}},t._l(t.columns,(function(e,a){return n("el-table-column",{key:a,attrs:{prop:e,label:e},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[n("el-tooltip",{attrs:{effect:"dark",content:s[e],placement:"top"}},[n("div",{staticClass:"text-ellipsis"},[t._v(t._s(s[e]))])])]}}],null,!0)})})),1),t.tableData.length>0?n("el-pagination",{attrs:{"current-page":t.currentPage,"page-sizes":[5,10,20,40],"page-size":t.pageSize,layout:"sizes, prev, pager, next, jumper",total:t.tableData.length},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}):t._e()],1)],1)},m=[],x=n("a34a"),q=n.n(x),y=n("c949");function w(t,e,n,a,s,i,l){try{var r=t[i](l),c=r.value}catch(u){return void n(u)}r.done?e(c):Promise.resolve(c).then(a,s)}function C(t){return function(){var e=this,n=arguments;return new Promise((function(a,s){var i=t.apply(e,n);function l(t){w(i,a,s,l,r,"next",t)}function r(t){w(i,a,s,l,r,"throw",t)}l(void 0)}))}}var I={props:{selectSql:{type:Object,default:{}}},data:function(){return{sqlInput:"",tagsList:[],activeIndex:0,columns:[],tableData:[],currentPage:1,pageSize:10}},mounted:function(){},methods:{addTag:function(){this.sqlInput="",this.tagsList.push({value:"",timestamp:(new Date).getTime()}),this.activeIndex=this.tagsList.length-1,this.$refs.elInput.focus()},handleClose:function(t,e){this.sqlInput="",this.tagsList.splice(e,1)},clickTag:function(t,e){this.activeIndex=e,this.sqlInput=t.value,this.$refs.elInput.focus()},query:function(){var t=this;return C(q.a.mark((function e(){var n,a,s;return q.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.tableData=[],e.next=3,y["f"].query({clusterName:t.$route.params.id,query:"".concat(t.sqlInput)});case 3:if(n=e.sent,a=n.data.entity,a.length&&(t.columns=a[0],a.splice(0,1),Object.values(a).map((function(e,n){var a={};e.forEach((function(e,n){a[t.columns[n]]=e})),t.tableData.push(a)}))),s=t.tagsList.find((function(e,n){return n===t.activeIndex})),s.value=t.sqlInput,s.value){e.next=11;break}return t.$message.warning("sql cannot be empty"),e.abrupt("return");case 11:t.$nextTick((function(){return t.$emit("updateData",s)}));case 12:case"end":return e.stop()}}),e)})))()},handleSizeChange:function(t){this.pageSize=t},handleCurrentChange:function(t){this.currentPage=t}},watch:{selectSql:function(t){var e=this.tagsList.some((function(e){return e.value===t.value}));e?this.activeIndex=this.tagsList.findIndex((function(e){return e.value===t.value})):(this.tagsList.push(t),this.activeIndex=this.tagsList.length-1),this.sqlInput=t.value,this.$refs.elInput.focus()}}},S=I,_=(n("ba39"),Object(d["a"])(S,b,m,!1,null,"ea5f01fe",null)),k=_.exports,D={data:function(){return{list:[],selectedSql:{}}},created:function(){this.fetchData()},methods:{fetchData:function(){var t=localStorage.getItem("sqlHisToryData");this.list="undefined"===t||Object(i["a"])(t)?[]:JSON.parse(t)},selectSql:function(t){this.selectedSql=t},updateData:function(t){this.list.unshift(t),this.list=u(this.list,"value"),localStorage.setItem("sqlHisToryData",JSON.stringify(this.list.slice(0,20))),this.fetchData()}},components:{LeftAside:g,Tags:k}},L=D,$=(n("8c16"),Object(d["a"])(L,a,s,!1,null,"caf2d4de",null));e["default"]=$.exports}}]);