(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fc38155c"],{"102f":function(e,t,n){"use strict";var a=n("7358"),i=n.n(a);i.a},"1b26":function(e,t,n){"use strict";var a=n("5943"),i=n.n(a);i.a},"1b88":function(e,t,n){"use strict";var a=n("e07c"),i=n.n(a);i.a},3411:function(e,t,n){"use strict";var a=n("a046"),i=n.n(a);i.a},"43e4":function(e,t,n){},5943:function(e,t,n){},7358:function(e,t,n){},8486:function(e,t,n){},"8aa5f":function(e,t,n){"use strict";var a=n("d740"),i=n.n(a);i.a},"8cbb":function(e,t,n){"use strict";var a=n("9ac7"),i=n("0148");function r(e,t){var n=null==e?0:e.length;return!!n&&Object(i["a"])(e,t,0)>-1}var s=r;function l(e,t,n){var a=-1,i=null==e?0:e.length;while(++a<i)if(n(t,e[a]))return!0;return!1}var o=l,u=n("6568"),c=n("a55c");function d(){}var f=d,p=n("1989"),m=1/0,h=c["a"]&&1/Object(p["a"])(new c["a"]([,-0]))[1]==m?function(e){return new c["a"](e)}:f,v=h,y=200;function b(e,t,n){var i=-1,r=s,l=e.length,c=!0,d=[],f=d;if(n)c=!1,r=o;else if(l>=y){var m=t?null:v(e);if(m)return Object(p["a"])(m);c=!1,r=u["a"],f=new a["a"]}else f=t?[]:d;e:while(++i<l){var h=e[i],b=t?t(h):h;if(h=n||0!==h?h:0,c&&b===b){var g=f.length;while(g--)if(f[g]===b)continue e;t&&f.push(b),d.push(h)}else r(f,b,n)||(f!==d&&f.push(b),d.push(h))}return d}t["a"]=b},"9c72":function(e,t,n){"use strict";var a=n("43e4"),i=n.n(a);i.a},a046:function(e,t,n){},d3fa:function(e,t,n){"use strict";var a=n("8486"),i=n.n(a);i.a},d740:function(e,t,n){},e07c:function(e,t,n){},f204:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("main",{staticClass:"query flex flex-column height-full pb-20"},[n("breadcrumb",{attrs:{data:["Clusters",e.$route.params.id,"query-execution"]}}),n("SqlSelectTool",{staticClass:"flex-1"})],1)},i=[];function r(e){return null===e}var s=r,l=n("7f2c"),o=n("8cbb");function u(e,t){return e&&e.length?Object(o["a"])(e,Object(l["a"])(t,2)):[]}var c=u,d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("multipane",{staticClass:"vertical-panes sql-select-tool custom-resizer ",staticStyle:{border:"none"},attrs:{layout:"vertical"}},[n("div",{staticClass:"pane",style:{minWidth:"100px",width:"280px",maxWidth:"400px"}},[n("el-tabs",{staticClass:"custom-tab db-tree-tabs",attrs:{value:"table"}},[n("el-tab-pane",{attrs:{label:e.$t("queryExecution.Database"),name:"table"}},[n("dbTree")],1)],1)],1),n("multipane-resizer"),n("div",{staticClass:"pane",style:{flexGrow:1,flex:1}},[n("multipane",{staticClass:"horizontal-panes custom-resizer",attrs:{layout:"horizontal"}},[n("div",{staticClass:"pane",style:{minWidth:"100%",width:"100%",maxWidth:"100%",height:"50%",minHeight:"20%",maxHeight:"90%"}},[n("el-tabs",{staticClass:"custom-tab custom-tab-flex",attrs:{value:"console"}},[n("el-tab-pane",{attrs:{label:e.$t("queryExecution.SQL Console"),name:"console"}},[n("sql-editor",{ref:"sqlEditor",on:{startRun:function(t){e.bottomActiveTab="result"}}})],1)],1)],1),n("multipane-resizer"),n("div",{staticClass:"pane",style:{flexGrow:1,flex:1,width:"100%"}},[n("el-tabs",{staticClass:"custom-tab-flex custom-tab-bottom",on:{"tab-click":e.handleClick},model:{value:e.bottomActiveTab,callback:function(t){e.bottomActiveTab=t},expression:"bottomActiveTab"}},[n("el-tab-pane",{attrs:{label:e.$t("queryExecution.Query History"),name:"history"}},[n("run-history",{on:{addSql:e.onAddSql}})],1),n("el-tab-pane",{attrs:{label:e.$t("queryExecution.Result"),name:"result"}},[n("sql-result")],1)],1)],1)],1)],1)],1)},f=[],p="horizontal",m="vertical",h={name:"multipane",props:{layout:{type:String,default:m}},data:function(){return{isResizing:!1}},computed:{classnames:function(){return["multipane","layout-"+this.layout.slice(0,1),this.isResizing?"is-resizing":""]},cursor:function(){return this.isResizing?this.layout==m?"col-resize":"row-resize":""},userSelect:function(){return this.isResizing?"none":""}},methods:{onMouseDown:function(e){var t=e.target,n=e.pageX,a=e.pageY;if(t.className&&t.className.match("multipane-resizer")){var i=this,r=i.$el,s=i.layout,l=t.previousElementSibling,o=l.offsetWidth,u=l.offsetHeight,c=!!(l.style.width+"").match("%"),d=window.addEventListener,f=window.removeEventListener,h=function(e,t){if(void 0===t&&(t=0),s==m){var n=r.clientWidth,a=e+t;return l.style.width=c?a/n*100+"%":a+"px"}if(s==p){var i=r.clientHeight,o=e+t;return l.style.height=c?o/i*100+"%":o+"px"}};i.isResizing=!0;var v=h();i.$emit("paneResizeStart",l,t,v);var y=function(e){var r=e.pageX,c=e.pageY;v=s==m?h(o,r-n):h(u,c-a),i.$emit("paneResize",l,t,v)},b=function e(){v=h(s==m?l.clientWidth:l.clientHeight),i.isResizing=!1,f("mousemove",y),f("mouseup",e),i.$emit("paneResizeStop",l,t,v)};d("mousemove",y),d("mouseup",b)}}}};!function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),n=".multipane { display: flex; } .multipane.layout-h { flex-direction: column; } .multipane.layout-v { flex-direction: row; } .multipane > div { position: relative; z-index: 1; } .multipane-resizer { display: block; position: relative; z-index: 2; } .layout-h > .multipane-resizer { width: 100%; height: 10px; margin-top: -10px; top: 5px; cursor: row-resize; } .layout-v > .multipane-resizer { width: 10px; height: 100%; margin-left: -10px; left: 5px; cursor: col-resize; } ";t.type="text/css",t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n)),e.appendChild(t)}}();var v=Object.assign(h,{render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{class:e.classnames,style:{cursor:e.cursor,userSelect:e.userSelect},on:{mousedown:e.onMouseDown}},[e._t("default")],2)},staticRenderFns:[]});v.prototype=h.prototype,function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.styleSheet?t.styleSheet.cssText="":t.appendChild(document.createTextNode("")),e.appendChild(t)}}();var y={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"multipane-resizer"},[e._t("default")],2)},staticRenderFns:[]};"undefined"!=typeof window&&window.Vue&&(window.Vue.component("multipane",v),window.Vue.component("multipane-resizer",y));var b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flex flex-column height-full pl-5 pr-5"},[n("el-input",{attrs:{size:"mini",placeholder:e.$t("common.keyword search"),clearable:""},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),n("el-tree",{ref:"tree",staticClass:"filter-tree flex-1 mt-5",attrs:{data:e.data,props:e.defaultProps,"filter-node-method":e.filterNode},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,i=t.data;return n("span",{staticClass:"custom-tree-node"},[n("i",{class:i.icon}),n("span",{staticClass:"ml-5"},[e._v(e._s(a.label))])])}}])})],1)},g=[],x=n("a34a"),w=n.n(x),q=n("c949");function S(e,t,n,a,i,r,s){try{var l=e[r](s),o=l.value}catch(u){return void n(u)}l.done?t(o):Promise.resolve(o).then(a,i)}function C(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var r=e.apply(t,n);function s(e){S(r,a,i,s,l,"next",e)}function l(e){S(r,a,i,s,l,"throw",e)}s(void 0)}))}}var z={watch:{filterText:function(e){this.$refs.tree.filter(e)}},data:function(){return{filterText:"",data:[],defaultProps:{children:"children",label:"label"}}},created:function(){this.getTableList()},methods:{filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},getTableList:function(){var e=this;return C(w.a.mark((function t(){var n,a,i,r;return w.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.$route.params.id,t.next=3,q["f"].getTableLists(n);case 3:a=t.sent,i=a.data.entity,r=Object.keys(i).map((function(e){var t={id:e,label:e,icon:"fa fa-database",children:Object.keys(i[e]).map((function(t){var n={id:t,label:t,icon:"fa fa-table",children:i[e][t].map((function(e){return{id:e,label:e,icon:"fa fa-columns"}}))};return n}))};return t})),e.data=r;case 7:case"end":return t.stop()}}),t)})))()}}},E=z,$=(n("1b88"),n("2877")),_=Object($["a"])(E,b,g,!1,null,null,null),k=_.exports,T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"sql-editor pl-5 pr-5 height-full flex flex-column"},[n("div",{staticClass:"sql-editor-toolbar mb-5"},[n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.run()}}},[e._v(e._s(e.$t("queryExecution.Execute Query"))+"( F8 )")]),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.run("schedule")}}},[e._v(e._s(e.$t("queryExecution.Execute Explain"))+"( F9 )")]),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.format}},[e._v(e._s(e.$t("queryExecution.Format"))+"( F10 )")])],1),n("div",{staticClass:"sql-editor-main flex-1"},[n("sql-code-mirror",{ref:"sqlCodeEditor",staticStyle:{height:"100%"},attrs:{"read-only":!1},model:{value:e.sql,callback:function(t){e.sql=t},expression:"sql"}})],1)])},O=[],R=n("3617"),N=n("4360"),P=(n("c1df"),n("08ba"));function D(e,t,n,a,i,r,s){try{var l=e[r](s),o=l.value}catch(u){return void n(u)}l.done?t(o):Promise.resolve(o).then(a,i)}function j(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var r=e.apply(t,n);function s(e){D(r,a,i,s,l,"next",e)}function l(e){D(r,a,i,s,l,"throw",e)}s(void 0)}))}}var H={components:{SqlCodeMirror:R["b"]},data:function(){return{sql:""}},created:function(){},mounted:function(){window.addEventListener("keydown",this.handleKeydown)},beforeDestroy:function(){window.removeEventListener("keydown",this.handleKeydown)},methods:{run:function(e){var t=this;return j(w.a.mark((function n(){var a,i,r,s,l;return w.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.$refs.sqlCodeEditor.sqlEditor.getSelection(),i=t.$route.params.id,r=t.sql,a||r){n.next=6;break}return P["c"].warning(t.$t("queryExecution.No Sql")),n.abrupt("return");case 6:return t.$emit("startRun"),N["a"].commit("sqlSelect/setStatus","loading"),n.next=10,q["f"]["schedule"===e?"queryExplain":"query"]({clusterName:i,query:a||r})["finally"]((function(){N["a"].commit("sqlSelect/setStatus","")}));case 10:s=n.sent,l=s.data.entity,N["a"].dispatch("sqlSelect/retrieveHistory",i),N["a"].commit("sqlSelect/setResult",l);case 14:case"end":return n.stop()}}),n)})))()},format:function(){var e;null===(e=this.$refs.sqlCodeEditor)||void 0===e||e.format()},handleKeydown:function(e){switch(e.key){case"F8":this.run();break;case"F9":this.run("schedule");break;case"F10":this.format();break}},addSql:function(e){this.$refs.sqlCodeEditor.sqlEditor.setValue(this.sql+(this.sql?"\n\n":"")+e)}}},L=H,F=(n("8aa5f"),Object($["a"])(L,T,O,!1,null,null,null)),A=F.exports,Q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"height-full flex flex-column"},[n("div",{staticClass:"flex flex-reverse flex-1"},[n("vxe-toolbar",{staticClass:"pull-right fs-0 vxe-toolbar-custom",attrs:{zoom:"",custom:"",size:"mini"}}),n("vxe-table",e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"flex-1 vxe-table-custom",attrs:{border:"",size:"mini","show-overflow":"","empty-text":e.$t("queryExecution.No Data"),data:e.currentPageData,height:"100%"},on:{"sort-change":e.sortChangeEvent}},"vxe-table",e.gridOptions,!1),e._l(e.columns,(function(t,a){return n("vxe-column",{key:a,attrs:{field:t.prop,title:t.label,"min-width":180,sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row,i=t.column;return[n("span",{staticClass:"text-ellipsis"},[e._v(e._s(a[i.property]))])]}}],null,!0)})})),1)],1),n("vxe-pager",{attrs:{"current-page":e.pagination.currentPage,"page-size":e.pagination.pageSize,"page-sizes":e.pagination.pageSizes,total:e.pagination.total,layouts:["PrevPage","JumpNumber","NextPage","FullJump","Sizes","Total"]},on:{"update:pageSize":function(t){return e.$set(e.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.pagination,"pageSize",t)},"page-change":e.handlePageChange}})],1)},I=[];function W(e){return W="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}var J={data:function(){return{loading:!1,sort:{},gridOptions:{border:!0,resizable:!0,showHeaderOverflow:!0,showOverflow:!0,highlightHoverRow:!0,rowId:"tableName",sortConfig:{trigger:"cell"},filterConfig:{}}}},computed:{columns:function(){return N["a"].getters["sqlSelect/getResultColumn"]},datas:function(){var e=N["a"].getters["sqlSelect/getResultData"],t=this.sort,n=t.property,a=t.order;return e.sort((function(e,t){var i=W(e[n]);if("number"===i){var r=e[n]-t[n];if("asc"===a)return r;if("desc"===a)return-r}else if("string"===i){var s;if(s=e[n].length===t[n].length?e[n].localeCompare(t[n]):e[n].length-t[n].length,"asc"===a)return s;if("desc"===a)return-s}}))},currentPageData:function(){var e=this.pagination,t=e.currentPage,n=e.pageSize;return this.datas.slice((t-1)*n,t*n)},pagination:function(){return N["a"].state.sqlSelect.pagination},status:function(){return N["a"].state.sqlSelect.status}},watch:{status:function(e){this.loading="loading"===e}},methods:{handleSizeChange:function(e){N["a"].commit("sqlSelect/changePageSize",e)},handleCurrentChange:function(e){N["a"].commit("sqlSelect/changeCurrentPage",e)},handlePageChange:function(e){var t=e.currentPage;this.pagination.currentPage=t},sortChangeEvent:function(e){var t=e.property,n=e.order;this.sort={property:t,order:n}}}},M=J,V=(n("d3fa"),Object($["a"])(M,Q,I,!1,null,null,null)),K=V.exports,B=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-table",{staticClass:"history-list",staticStyle:{width:"100%"},attrs:{border:"","empty-text":e.$t("queryExecution.No Data"),size:"mini",data:e.historyList,height:"100%"}},[e._l(e.columns,(function(t,a){return n("el-table-column",{key:a,attrs:{prop:t.prop,label:t.label,width:t.width},scopedSlots:e._u([{key:"default",fn:function(a){return[n("span",{staticClass:"text-ellipsis",attrs:{title:a.row[t.prop]},on:{dblclick:function(t){return e.onClickCell(a)}}},[e._v(e._s(a.row[t.prop]))])]}}],null,!0)})})),n("el-table-column",{attrs:{label:e.$t("common.Action"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return e.copyItem(t.row)}}},[e._v(e._s(e.$t("queryExecution.Copy")))]),n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(n){return e.deleteItem(t.row)}}},[e._v(e._s(e.$t("common.Delete")))])]}}])})],2)},G=[],X={computed:{historyList:function(){return N["a"].state.sqlSelect.history},columns:function(){return[{prop:"QuerySql",label:this.$t("queryExecution.SQL")},{prop:"CreateTime",label:this.$t("queryExecution.CreateTime")}]}},created:function(){var e=this.$route.params.id;N["a"].dispatch("sqlSelect/retrieveHistory",e)},methods:{copyItem:function(e){try{var t=document.createElement("textarea");t.value=e.QuerySql,t.style.border="0",t.style.padding="0",t.style.margin="0",t.style.right="999999em",t.style.position="absolute",document.body.appendChild(t),t.select(),document.execCommand("copy"),P["c"].success(this.$t("queryExecution.Copy Success")),t=null}catch(n){}},deleteItem:function(e){var t=e.CheckSum,n=this.$route.params.id;N["a"].dispatch("sqlSelect/deleteHistory",{checksum:t,clusterName:n})},onClickCell:function(e){var t=e.row,n=e.column;"QuerySql"===n.property&&this.$emit("addSql",t.QuerySql)}}},Y=X,U=(n("1b26"),Object($["a"])(Y,B,G,!1,null,null,null)),Z=U.exports,ee={name:"sqlSelectTool",components:{Multipane:v,MultipaneResizer:y,dbTree:k,sqlEditor:A,sqlResult:K,runHistory:Z},data:function(){return{leftActiveTab:"table",bottomActiveTab:"result"}},beforeDestroy:function(){N["a"].commit("sqlSelect/clear")},methods:{handleClick:function(){},onAddSql:function(e){this.$refs.sqlEditor.addSql(e)}}},te=ee,ne=(n("3411"),n("102f"),Object($["a"])(te,d,f,!1,null,null,null)),ae=ne.exports,ie={components:{SqlSelectTool:ae},data:function(){return{list:[],selectedSql:{}}},created:function(){this.fetchData()},methods:{fetchData:function(){var e=localStorage.getItem("sqlHisToryData");this.list="undefined"===e||s(e)?[]:JSON.parse(e)},selectSql:function(e){this.selectedSql=e},updateData:function(e){this.list.unshift(e),this.list=c(this.list,"value"),localStorage.setItem("sqlHisToryData",JSON.stringify(this.list.slice(0,20))),this.fetchData()}}},re=ie,se=(n("9c72"),Object($["a"])(re,a,i,!1,null,"a0e03126",null));t["default"]=se.exports}}]);