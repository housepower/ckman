(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a5067fe"],{5517:function(t,e,a){},"93dc":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("main",{staticClass:"settings"},[a("breadcrumb",{attrs:{data:["Message Center"]}}),a("div",{staticClass:"title flex flex-between flex-vcenter ptb-10 pull-left"},[a("span",{staticClass:"fs-20 font-bold"},[t._v(t._s(t.$t("task.Task List")))]),a("span",{staticClass:"ml-5 fc-green fs-14"},[t._v("( "+t._s(t.$t("task.Running Task Num"))+" "+t._s(t.runningTaskNum)+" )")])]),a("vxe-toolbar",{staticClass:"pull-right",attrs:{zoom:"",custom:""},scopedSlots:t._u([{key:"buttons",fn:function(){return[a("el-input",{staticClass:"width-250 mr-10",attrs:{size:"medium",placeholder:t.$t("common.keyword search"),"suffix-icon":"el-icon-search"},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})]},proxy:!0}])}),a("vxe-table",t._b({directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"xTable",staticStyle:{clear:"both"},attrs:{columns:t.columns,data:t.currentPageData},on:{"sort-change":t.sortChangeEvent}},"vxe-table",t.gridOptions,!1),[t._l(t.columns,(function(e){var n=e.prop,i=e.label,s=e.minWidth,r=e.fixed,o=e.filters;return a("vxe-column",{key:n,attrs:{fixed:r,sortable:"",field:n,title:i,filters:o||null,"min-width":s||140},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row,i=e.column;return["Option"===i.property?a("span",[t._v(t._s(n.Option[t.lang]))]):a("span",[t._v(t._s(n[i.property]))])]}}],null,!0)})})),a("vxe-column",{attrs:{fixed:"right",align:"center",title:t.$t("tables.Action"),width:"140"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return t.viewDetail(e.row)}}},[t._v(t._s(t.$t("task.View")))]),a("el-button",{attrs:{type:"text",size:"small",disabled:!["Success","Failed"].includes(e.row.Status)},on:{click:function(a){return t.deleteTask(e.row.TaskId)}}},[t._v(t._s(t.$t("common.Delete")))])]}}])})],2),a("vxe-pager",{attrs:{"current-page":t.pagination.currentPage,"page-size":t.pagination.pageSize,"page-sizes":t.pagination.pageSizes,total:t.pagination.total,layouts:["PrevPage","JumpNumber","NextPage","FullJump","Sizes","Total"]},on:{"update:pageSize":function(e){return t.$set(t.pagination,"pageSize",e)},"update:page-size":function(e){return t.$set(t.pagination,"pageSize",e)},"page-change":t.handlePageChange}})],1)},i=[],s=a("a34a"),r=a.n(s),o=a("c949"),l=a("08ba"),u=a("fe42");function c(t,e,a,n,i,s,r){try{var o=t[s](r),l=o.value}catch(u){return void a(u)}o.done?e(l):Promise.resolve(l).then(n,i)}function p(t){return function(){var e=this,a=arguments;return new Promise((function(n,i){var s=t.apply(e,a);function r(t){c(s,n,i,r,o,"next",t)}function o(t){c(s,n,i,r,o,"throw",t)}r(void 0)}))}}function d(t){return d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}var g={data:function(){return{tableData:[],headerData:[],loading:!1,isLoaded:!1,searchKey:"",sort:{},pagination:{total:0,pageSize:10,pageSizes:[10,15,20,50,100,200,500,1e3],currentPage:1},gridOptions:{border:!0,resizable:!0,showHeaderOverflow:!0,showOverflow:!0,highlightHoverRow:!0,rowId:"TaskId",toolbarConfig:{zoom:!0,custom:!0},sortConfig:{trigger:"cell"},filterConfig:{}},clusters:[],runningTaskNum:null,timerId:null}},computed:{columns:function(){var t=this.clusters;return[{prop:"TaskId",label:this.$t("task.Task ID")},{prop:"ClusterName",label:this.$t("task.Cluster Name"),filters:t},{prop:"Type",label:this.$t("task.Task Type")},{prop:"Option",label:this.$t("task.Task Name")},{prop:"Status",label:this.$t("task.Task Status"),filters:[{label:"Waiting",value:"Waiting"},{label:"Running",value:"Running"},{label:"Failed",value:"Failed"},{label:"Success",value:"Success"}]},{prop:"Message",label:this.$t("task.Message")},{prop:"CreateTime",label:this.$t("task.Create Time")},{prop:"UpdateTime",label:this.$t("task.Update Time")},{prop:"Duration",label:this.$t("task.Duration")}]},lang:function(){return this.$i18n.locale.toUpperCase()},listData:function(){var t=this.searchKey,e=this.sort,a=e.property,n=e.order,i=this.lang,s=this.tableData.filter((function(e){var a,n,s,r,o,l=!0;return(null===(a=e.ClusterName)||void 0===a?void 0:a.includes(t))||(null===(n=e.Type)||void 0===n?void 0:n.includes(t))||(null===(s=e.Status)||void 0===s?void 0:s.includes(t))||(null===(r=e.Option[i])||void 0===r?void 0:r.includes(t))||(null===(o=e.TaskId)||void 0===o?void 0:o.includes(t))||(l=!1),l})).sort((function(t,e){var i=d(t[a]);if("number"===i){var s=t[a]-e[a];if("asc"===n)return s;if("desc"===n)return-s}else if("string"===i){var r;if(r=t[a].length===e[a].length?t[a].localeCompare(e[a]):t[a].length-e[a].length,"asc"===n)return r;if("desc"===n)return-r}}));return s},currentPageData:function(){var t,e=this.pagination,a=e.currentPage,n=e.pageSize;return null===(t=this.listData)||void 0===t?void 0:t.slice((a-1)*n,a*n)}},watch:{"listData.length":function(t){this.pagination.currentPage=1,this.pagination.total=t}},created:function(){var t=this;return p(r.a.mark((function e(){return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getClusterList();case 2:t.fetchData(),t.getRunningTasks(),t.timerId=setInterval(t.refresh,3e3);case 5:case"end":return e.stop()}}),e)})))()},beforeDestroy:function(){this.timerId&&clearInterval(this.timerId)},methods:{getClusterList:function(){var t=this;return p(r.a.mark((function e(){var a,n;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o["a"].getCluster();case 2:a=e.sent,n=a.data.entity,t.clusters=Object.keys(n).map((function(t){return{label:t,value:t}}));case 5:case"end":return e.stop()}}),e)})))()},sortChangeEvent:function(t){var e=t.property,a=t.order;this.sort={property:e,order:a}},handlePageChange:function(t){this.pagination.currentPage=t.currentPage},fetchData:function(){var t=this;return p(r.a.mark((function e(){var a,n;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o["h"].getLists()["finally"]((function(){t.isLoaded=!0}));case 2:a=e.sent,n=a.data.entity,t.tableData=n,0===n.filter((function(t){return!["Success","Failed"].includes(t.Status)})).length&&t.timerId&&clearInterval(t.timerId);case 6:case"end":return e.stop()}}),e)})))()},deleteTask:function(t){var e=this;return p(r.a.mark((function a(){return r.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$confirm(e.$t("task.Delete Task"),e.$t("common.tips"),{confirmButtonText:e.$t("common.Confirm"),cancelButtonText:e.$t("common.Cancel")});case 2:return a.next=4,o["h"].deleteTask(t);case 4:l["c"].success(e.$t("common.Delete")+e.$t("common.Success")),e.fetchData();case 6:case"end":return a.stop()}}),a)})))()},getRunningTasks:function(){var t=this;return p(r.a.mark((function e(){var a,n;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o["h"].getRunningLists();case 2:a=e.sent,n=a.data.entity,t.runningTaskNum=n;case 5:case"end":return e.stop()}}),e)})))()},viewDetail:function(t){Object(l["d"])({component:u["a"],props:{title:this.$t("task.View Task"),width:800,cancelText:this.$t("task.Close"),okText:null},data:{taskId:t.TaskId,refresh:["Waiting","Running"].includes(t.Status)}})},refresh:function(){this.fetchData(),this.getRunningTasks()}}},f=g,h=a("2877"),v=Object(h["a"])(f,n,i,!1,null,"464dd0e6",null);e["default"]=v.exports},a26d:function(t,e,a){"use strict";var n=a("5517"),i=a.n(n);i.a},fe42:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-detail"},[t.detail?a("div",{staticClass:"mb-20"},[a("label",[t._v(t._s(t.$t("task.Task ID"))+"：")]),a("span",{staticClass:"fc-black"},[t._v(t._s(t.detail.TaskId))]),a("label",{staticClass:"ml-20"},[t._v(t._s(t.$t("task.Cluster Name"))+"：")]),a("span",{staticClass:"fc-black"},[t._v(t._s(t.detail.ClusterName))]),a("label",{staticClass:"ml-20"},[t._v(t._s(t.$t("task.Current Action"))+"：")]),a("span",{staticClass:"fc-black"},[t._v(t._s(t.detail.Option[t.lang]))])]):t._e(),a("vxe-table",t._b({ref:"xTable",staticStyle:{clear:"both"},attrs:{size:"mini",columns:t.columns,data:t.currentPageData}},"vxe-table",t.gridOptions,!1),[a("vxe-column",{attrs:{fixed:"right",align:"center",title:t.$t("task.Node"),field:"Host"}}),a("vxe-column",{attrs:{fixed:"right",align:"center",title:t.$t("task.Status"),field:"Status"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"flex flex-vcenter flex-center"},[t.loading?a("img",{staticClass:"mr-20",attrs:{src:"/images/5-130H2191322-50.gif"}}):t._e(),a("span",{staticClass:"status",class:e.row.Status.EN},[t._v(t._s(e.row.Status[t.lang]))])])]}}])})],1),a("vxe-pager",{attrs:{align:"center","current-page":t.pagination.currentPage,"page-size":t.pagination.pageSize,"page-sizes":t.pagination.pageSizes,total:t.pagination.total,layouts:["PrevPage","JumpNumber","NextPage","Total"]},on:{"update:pageSize":function(e){return t.$set(t.pagination,"pageSize",e)},"update:page-size":function(e){return t.$set(t.pagination,"pageSize",e)},"page-change":t.handlePageChange}})],1)},i=[],s=a("a34a"),r=a.n(s),o=a("c949");function l(t,e,a,n,i,s,r){try{var o=t[s](r),l=o.value}catch(u){return void a(u)}o.done?e(l):Promise.resolve(l).then(n,i)}function u(t){return function(){var e=this,a=arguments;return new Promise((function(n,i){var s=t.apply(e,a);function r(t){l(s,n,i,r,o,"next",t)}function o(t){l(s,n,i,r,o,"throw",t)}r(void 0)}))}}var c={props:{taskId:String,refresh:Boolean},data:function(){return{timerId:null,detail:null,pagination:{total:0,pageSize:10,pageSizes:[10,15,20,50,100,200,500,1e3],currentPage:1},gridOptions:{border:!0,resizable:!0,showHeaderOverflow:!0,showOverflow:!0,highlightHoverRow:!0,rowId:"Host"},loading:!1}},computed:{columns:function(){return[{prop:"Host"},{prop:"Status"}]},lang:function(){return this.$i18n.locale.toUpperCase()},currentPageData:function(){var t,e,a=this.pagination,n=a.currentPage,i=a.pageSize;return null===(t=this.detail)||void 0===t||null===(e=t.NodeStatus)||void 0===e?void 0:e.slice((n-1)*i,n*i)}},created:function(){this.getTaskDetail(),this.refresh&&(this.loading=!0,this.timerId=setInterval(this.getTaskDetail,3e3))},beforeDestroy:function(){this.timerId&&clearInterval(this.timerId)},methods:{getTaskDetail:function(){var t=this;return u(r.a.mark((function e(){var a,n;return r.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o["h"].getTaskDetail(t.taskId);case 2:a=e.sent,n=a.data.entity,t.detail=n,t.pagination.currentPage=1,t.pagination.total=n.NodeStatus.length,0==n.NodeStatus.filter((function(t){return!["Done","Failed"].includes(t.Status.EN)})).length&&(clearInterval(t.timerId),t.loading=!1);case 8:case"end":return e.stop()}}),e)})))()},handlePageChange:function(t){this.pagination.currentPage=t.currentPage}}},p=c,d=(a("a26d"),a("2877")),g=Object(d["a"])(p,n,i,!1,null,"40081df2",null);e["a"]=g.exports}}]);